---
title: "fRegress on Fei's Data"
author: "Rohan Mishra"
date: "6/23/2022"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = FALSE)
library(fda)
library(tidyverse)
library(deSolve)
source("/mnt/fda_CI.R")

```

```{r load data}

### load datasets
d <- dir("/mnt/DATA/Tin Variation/")
fei_data <- list()
for(i in 1:3){
  fei_data[[i]] <- read.csv(paste("/mnt/DATA/Tin Variation/",d[i],sep = ""))
}
names(fei_data) <- c("345","350","355")


#### get the time and chosen variable (concentrationA) together in one frame
fei_data2 <- lapply(fei_data, function(i){
  i %>%
    select(time, concentrationA)
}) %>%
  reduce(full_join,by="time")
names(fei_data2) <- c("time",names(fei_data))



```

Below is the functional data for output Ca with variations in initial Inlet Temperature. We then conduct a functional regression of Output Ca function as a response to scalar Inlet Temperature.

```{r convert to fda}


basis <- create.bspline.basis(rangeval = c(0,5001), nbasis = 25)

data_fd <- smooth.basis(argvals = 1:5001,fei_data2[,-1] %>% as.matrix(),basis)$fd

par(mfrow=c(1,1))
plot(data_fd);legend("bottomright", legend = c("345","350","355"), fill = c("black", "red","green")); title("Functional Output C_a with Different Tin");grid()

```


```{r fRegress}

temp_inlet <- names(fei_data2[,-1]) %>% as.numeric()

contRegression <- fRegress(data_fd ~ temp_inlet)

par(mfrow=c(2,2))
plot.fd(contRegression$betaestlist$const$fd); grid(); title(main="Constant Regression Curve")
#plot.fd(catRegress$betaestlist$temps.cat.280$fd); grid()
plot.fd(contRegression$betaestlist$temp_inlet); grid(); title(main = "Tin Variable Coefficient")
plot(contRegression$yhatfdobj$fd); grid(); title("yhat");legend("bottomright", legend = c("345","350","355"), fill = c("black", "red","green"))




```


```{r load Tin & Tc data}

### load datasets
d2 <- dir("/mnt/DATA/Tin & Tc Variation/")
fei_data_Tc_Tin <- list()
for(i in 1:3){
  fei_data_Tc_Tin[[i]] <- read.csv(paste("/mnt/DATA/Tin & Tc Variation/",d2[i],sep = ""))
}
names(fei_data_Tc_Tin) <- c("345_300","350_275","355_250")


#### get the time and chosen variable (concentrationA) together in one frame
fei_data2_Tc_Tin <- lapply(fei_data_Tc_Tin, function(i){
  i %>%
    select(time, concentrationA)
}) %>%
  reduce(full_join,by="time")
names(fei_data2_Tc_Tin) <- c("time",names(fei_data_Tc_Tin))


```

Below is the functional data for output Ca with variations in both initial Inlet Temperature & Cooling Temperature. We then conduct a functional regression of Output Ca function as a response to scalar Cooling Temperature only.

```{r convert to fda again}



data_fd2 <- smooth.basis(argvals = 1:5001,fei_data2_Tc_Tin[,-1] %>% as.matrix(),basis)$fd

par(mfrow=c(1,1))
plot(data_fd2);grid(); title("Functional Output C_a with Different Tc & Tin");legend("bottomright", legend = c("Tin=355; Tc=250","Tin=350; Tc=275","Tin=345; Tc=300"), fill = c("green", "red","black"))

```

```{r fRegress with Tc}

#temp_inlet <- c(345,350,355)
temp_cool <- c(300,275,250)
#x <- c(100,200,300)
contRegressionTc <- fRegress(data_fd2 ~ temp_cool)

par(mfrow=c(2,2))
plot.fd(contRegressionTc$betaestlist$const$fd); grid(); title(main="Constant Regression Curve")
#plot.fd(catRegress$betaestlist$temps.cat.280$fd); grid()
plot.fd(contRegressionTc$betaestlist$temp_cool$fd); grid(); title(main = "Tc Variable Coefficient")
plot(contRegressionTc$yhatfdobj$fd); grid(); title("yhat");legend("bottomright", legend = c("250","275","300"), fill = c("green", "red","black"))



```

```{r CA_in & Tin, include = FALSE}

fei_data2_CA_in <- lapply(fei_data_Tc_Tin, function(i){ 
i %>% 
  select(time, concentrationA_inlet) 
 }) %>% 
  reduce(full_join,by="time") 
names(fei_data2_CA_in) <- c("time",names(fei_data_Tc_Tin)) 

 basis <- create.bspline.basis(rangeval = c(0,5001), nbasis = 25) 

data_fd_CAin <- smooth.basis(argvals = 1:5001,fei_data2_CA_in[,-1] %>% as.matrix(),basis)$fd 

 plot(data_fd_CAin) 

 f <- fRegress(data_fd_CAin  ~ data_fd2) 

plot(f$betaestlist$const) 
plot(f$betaestlist$data_fd2) 
plot(f$yhatfdobj$fd) 


``` 
